# CVE-2022-22965 "Spring4Shell" Exploitation Paths
Adapted from https://twitter.com/AmitaiCo/status/1512288760897101825

## Dependency Tree
### CVE-2022-22965 `Spring4Shell` dependent components
```mermaid
graph TD
    Spring4Shell{"CVE-2022-22965<br/>`Spring4Shell`<br/><br/>sources"}
    spring-webmvc["org.springframework:<br/>spring-webmvc"]
    spring-webflux["org.springframework:<br/>spring-webflux"]
    spring-web["org.springframework:<br/>spring-web"]
    spring-core["org.springframework:<br/>spring-core"]
    spring-beans["org.springframework:<br/>spring-beans"]
    sink{"CachedIntrospectionResults"}
    %% dependencies
    Spring4Shell -->|ServletModelAttributeMethodProcessor| spring-webmvc
    Spring4Shell -->|ModelAttributeMethodArgumentResolver| spring-webflux
    spring-webmvc -->|requires| spring-web
    spring-webmvc -->|requires| spring-core    
    spring-webmvc -->|requires| spring-beans    
    spring-webflux -->|requires| spring-web
    spring-webflux -->|requires| spring-core
    spring-webflux -->|requires| spring-beans
    spring-beans -->|requires| spring-core
    spring-beans -->|sink| sink
```

## Call Trace

### CVE-2022-22965 `Spring4Shell` Currently known explotation methods

```mermaid
sequenceDiagram    
    participant webmvc as spring-webmvc<br/>org.springframework.web.servlet.mvc.method.annotation
    participant webflux as spring-webflux<br/>org.springframework.web.reactive.result.method.annotation
    participant web as spring-web<br/>org.springframework.web.bind
    participant context as spring-context<br/>org.springframework.validation
    participant beans as spring-beans<br/>org.springframework.beans
    autonumber
     alt spring-webmvc
        webmvc-->+web: ModelAttributeMethodArgumentResolver<br/>.bindRequestParameters()
    else spring-webflux
        webflux-->+web: ServletModelAttributeMethodProcessor<br/>.bindRequestParameters()
    end
        
    web-->+web: ServeletRequestDataBinder<br/>.bind()
    web-->+web: WebDataBinder<br/>.doBind()
    web-->+context: DataBinder<br/>.doBind()
    context-->+context: DataBinder<br/>.applyPropteryValues()
    context-->+beans: AbstractPropertyAccessor<br/>.setPropertyValues()
    beans-->+beans: AbstractNestablePropertyAccessor<br/>.setPropertyValue()
    beans-->+beans: AbstractNestablePropertyAccessor<br/>.processLocalProperty()
    beans-->+beans: BeanWrapperImpl<br/>.getLocalPropertyHandler()
    beans-->+beans: BeanWrapperImpl<br/>.getLocalPropertyHandler()
    beans-->+beans: CachedIntrospectionResults<br/>.getPropertyDescriptor()
```
